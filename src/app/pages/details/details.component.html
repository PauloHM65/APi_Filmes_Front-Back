<div class="container mt-5">
  <div *ngIf="isLoading" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <div *ngIf="movie$ | async as movie">
    <div class="details-container" *ngIf="movie$ | async as movie; else loadingOrError">
  <div class="movie-header">
    <img [src]="movie.Poster" [alt]="movie.Title" class="movie-poster" />
    <div class="movie-info">
      <h1>{{ movie.Title }} ({{ movie.Year }})</h1>
      <p><strong>Gênero:</strong> {{ movie.Genre }}</p>
      <p><strong>Diretor:</strong> {{ movie.Director }}</p>
      <p><strong>Atores:</strong> {{ movie.Actors }}</p>
      <p><strong>Enredo:</strong> {{ movie.Plot }}</p>
      <p><strong>IMDb Rating:</strong> {{ movie.imdbRating }}</p>
      <p *ngIf="movie.Rated"><strong>Classificação:</strong> {{ movie.Rated }}</p>
      <p *ngIf="movie.Released"><strong>Lançamento:</strong> {{ movie.Released }}</p>
      <p *ngIf="movie.Runtime"><strong>Duração:</strong> {{ movie.Runtime }}</p>
      <p *ngIf="movie.Language"><strong>Idioma:</strong> {{ movie.Language }}</p>
      <p *ngIf="movie.Country"><strong>País:</strong> {{ movie.Country }}</p>
      <p *ngIf="movie.Awards"><strong>Prêmios:</strong> {{ movie.Awards }}</p>
      <p *ngIf="movie.Metascore"><strong>Metascore:</strong> {{ movie.Metascore }}</p>
      <p *ngIf="movie.imdbVotes"><strong>Votos IMDb:</strong> {{ movie.imdbVotes }}</p>
      <p *ngIf="movie.Type"><strong>Tipo:</strong> {{ movie.Type }}</p>
      <p *ngIf="movie.totalSeasons"><strong>Total de Temporadas:</strong> {{ movie.totalSeasons }}</p>

      <div *ngIf="movie.Ratings && movie.Ratings.length > 0">
        <h3>Avaliações Externas:</h3>
        <div *ngFor="let rating of movie.Ratings">
          <p><strong>{{ rating.Source }}:</strong> {{ rating.Value }}</p>
        </div>
      </div>

      <button (click)="toggleFavorite(movie)">
        {{ (isFavorite$ | async) ? 'Remover dos Favoritos' : 'Adicionar aos Favoritos' }}
      </button>
    </div>
  </div>

  <div class="reviews-section">
    <h2>Avaliações</h2>
    <div *ngIf="reviews$ | async as reviews">
      <div *ngIf="reviews.length > 0; else noReviews">
        <div *ngFor="let review of reviews" class="review-card">
          <p><strong>Nota:</strong> {{ review.rating }}/5</p>
          <p>{{ review.comment }}</p>
          <p class="review-date">{{ review.date | date:'shortDate' }}</p>
          <button (click)="deleteReview(review.id, movie.imdbID)">Excluir</button>
        </div>
      </div>
      <ng-template #noReviews>
        <p>Nenhuma avaliação ainda. Seja o primeiro a avaliar!</p>
      </ng-template>
    </div>

    <div class="add-review">
      <h3>Adicionar Avaliação</h3>
      <form (ngSubmit)="onReviewSubmit(movie.imdbID)">
        <div class="form-group">
          <label for="rating">Nota: {{ newReview.rating }}</label>
          <input type="number" id="rating" [(ngModel)]="newReview.rating" name="rating" min="0" max="5" step="0.1" required>
        </div>
        <div class="form-group">
          <label for="comment">Comentário:</label>
          <textarea id="comment" [(ngModel)]="newReview.comment" name="comment" rows="3" required></textarea>
        </div>
        <button type="submit">Enviar Avaliação</button>
      </form>
    </div>
  </div>
</div>

<ng-template #loadingOrError>
  <div *ngIf="isLoading" class="loading-spinner">Carregando...</div>
  <div *ngIf="error" class="error-message">{{ error }}</div>
</ng-template>
  </div>
</div>